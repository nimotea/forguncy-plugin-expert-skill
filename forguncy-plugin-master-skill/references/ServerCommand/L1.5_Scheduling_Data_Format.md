# L1.5 调度逻辑数据格式 (L1.5 Scheduling Data Format)

本文档描述了 L1.5 调度逻辑所需的输入数据格式。该逻辑通常用于轻量级有限产能排程 (Lightweight Finite Capacity Scheduling)。

## 1. 数据概览

L1.5 调度逻辑需要两份核心 JSON 数据：
1.  **WorkOrders.json** (工单/生产订单)
2.  **Resources.json** (资源/机台)

您可以使用 `scripts/generate_l1_5_demo_data.py` 脚本快速生成测试数据。

```bash
python scripts/generate_l1_5_demo_data.py --orders 20 --resources 5
```

## 2. 数据结构详解

### 2.1 WorkOrders.json (工单)

工单列表，每个对象代表一个生产任务。

```json
[
  {
    "Id": "WO-001",           // [必填] 工单唯一标识
    "Product": "Product-A",   // [可选] 产品名称
    "Quantity": 100,          // [必填] 生产数量
    "ReleaseDate": "2023-10-01T08:00:00", // [可选] 最早开始时间 (ISO 8601)
    "DueDate": "2023-10-10T17:00:00",     // [必填] 交货期 (ISO 8601)
    "Priority": 1,            // [可选] 优先级 (数字越小越优先，默认 5)
    "Operations": [           // [必填] 工序列表 (按顺序执行)
      {
        "OpCode": "10",       // [必填] 工序代码
        "Name": "Op-Turning", // [可选] 工序名称
        "ResourceGroup": "Turning", // [必填] 所需资源组 (对应 Resources 中的 Group)
        "StandardTime": 0.5,  // [必填] 标准工时 (小时/件)
        "SetupTime": 30       // [可选] 换模/准备时间 (分钟)
      },
      // ... 后续工序
    ]
  }
]
```

### 2.2 Resources.json (资源)

资源列表，代表可用于生产的设备或人员。

```json
[
  {
    "Id": "RES-001",          // [必填] 资源唯一标识
    "Name": "Lathe-01",       // [可选] 资源名称
    "Group": "Turning",       // [必填] 资源组 (用于匹配工序需求)
    "Capacity": 1.0,          // [可选] 产能系数 (默认 1.0)
    "Efficiency": 0.95        // [可选] 效率 (影响实际工时，默认 1.0)
  }
]
```

## 3. 在活字格中的使用

1.  **准备数据**：将上述 JSON 结构的数据准备好 (通常来自数据库查询结果转 JSON)。
2.  **调用命令**：使用 `L1.5 Scheduling` 服务端命令。
3.  **参数映射**：
    -   `WorkOrders`: 选择包含工单 JSON 的变量。
    -   `Resources`: 选择包含资源 JSON 的变量。
4.  **获取结果**：命令执行后返回排程结果 JSON，包含每个工序的 `StartTime` 和 `EndTime`。

## 4. 常见问题

-   **Q: 资源组 (Group) 如何匹配?**
    -   A: 工序的 `ResourceGroup` 必须与资源的 `Group` 完全一致 (区分大小写)。如果找不到对应资源，该工序将无法排程。
-   **Q: 日期格式支持哪些?**
    -   A: 推荐使用 ISO 8601 标准格式 (`yyyy-MM-ddTHH:mm:ss`)，活字格内置的 JSON 序列化通常会自动处理。
